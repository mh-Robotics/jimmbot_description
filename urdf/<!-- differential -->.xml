<!-- differential -->
<xacro:macro name="differential" params="postfix reflect">

    <link name="differential_left_${postfix}" />

    <link name="differential_right_${postfix}" />

    <link name="differential_${postfix}">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://jimmbot_description/meshes/differential/differential.stl" scale="0.001 0.001 0.001"/>
            </geometry>
            <material name="silver"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://jimmbot_description/meshes/differential/differential.stl" scale="0.001 0.001 0.001"/>
            </geometry>
        </collision>
        <xacro:differential_inertial mass="0.8"/>
    </link>

    <joint name="differential_${postfix}_to_differential_left_${postfix}" type="fixed">
        <origin rpy="0 0 0" xyz="120E-03 0 0"/>
        <parent link="differential_${postfix}"/>
        <child link="differential_left_${postfix}"/>
    </joint>

    <joint name="differential_${postfix}_to_differential_right_${postfix}" type="fixed">
        <origin rpy="0 0 0" xyz="-120E-03 0 0"/>
        <parent link="differential_${postfix}"/>
        <child link="differential_right_${postfix}"/>
    </joint>

    <joint name="chassis_to_differential_${postfix}" type="revolute">
        <axis xyz="0 0 -1"/>
        <limit effort="1000.0" lower="-0.523599" upper="0.523599" velocity="50"/>
        <origin rpy="0 0 ${reflect*1.57}" xyz="${reflect*147.5E-03} 0 147.0E-03"/>
        <parent link="chassis"/>
        <child link="differential_${postfix}"/>
    </joint>
</xacro:macro>
<xacro:differential postfix="front" reflect="1"/>
<xacro:differential postfix="back" reflect="-1"/>
<!-- end differential -->

<!-- differential_rod -->
<xacro:macro name="differential_rod" params="postfix boggie reflect">

    <link name="differential_rod_differential_${postfix}_${boggie}" />

    <link name="differential_rod_boggie_${postfix}_${boggie}" />
    
    <link name="differential_rod_${postfix}_${boggie}">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://jimmbot_description/meshes/differential/differential_rod.stl" scale="0.01 0.01 0.01"/>
            </geometry>
            <material name="silver"/>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://jimmbot_description/meshes/differential/differential_rod.stl" scale="0.01 0.01 0.01"/>
            </geometry>
        </collision>
        <xacro:differential_inertial mass="0.8"/>
    </link>

    <joint name="differential_rod_${postfix}_${boggie}_to_differential_rod_boggie_${postfix}_${boggie}" type="fixed">
        <origin rpy="0 0 0" xyz="-82E-03 0 0"/>
        <parent link="differential_rod_${postfix}_${boggie}"/>
        <child link="differential_rod_boggie_${postfix}_${boggie}"/>
    </joint>

    <joint name="differential_rod_${postfix}_${boggie}_to_differential_rod_differential_${postfix}_${boggie}" type="fixed">
        <origin rpy="0 0 0" xyz="82E-03 0 0"/>
        <parent link="differential_rod_differential_${postfix}_${boggie}"/>
        <child link="differential_rod_${postfix}_${boggie}"/>
    </joint>

    <joint name="differential_rod_differential_${postfix}_${boggie}_to_differential_${boggie}_${postfix}" type="fixed">
        <origin rpy="0 0.087266 ${reflect*0.453786}" xyz="${reflect*0} 0 150E-03"/>
        <parent link="differential_${boggie}_${postfix}"/>
        <child link="differential_rod_differential_${postfix}_${boggie}"/>
    </joint>

    <joint name="differential_rod_boggie_${postfix}_${boggie}_to_boggie_${boggie}" type="fixed">
        <origin rpy="0 0.087266 ${reflect*0.453786}" xyz="${reflect*0} 0 150E-03"/>
        <parent link="boggie_${boggie}_front_rods"/>
        <child link="differential_rod_differential_${postfix}_${boggie}"/>
    </joint>

    <joint name="differential_rod_to_base_link" type="fixed">
        <parent link="base_link"/>
        <child link="differential_rod_${postfix}_${boggie}"/>
    </joint>

    <!-- <joint name="differential_rod_differential_${postfix}_${boggie}_to_boggie_${boggie}" type="fixed">
        <origin rpy="0 0.087266 ${reflect*-0.453786}" xyz="${reflect*0} 0 15E-03"/>
        <parent link="differential_${boggie}_${postfix}"/>
        <child link="differential_rod_${postfix}_${boggie}"/>
    </joint>

    <joint name="differential_rod_boggie_${postfix}_${boggie}_to_boggie_${boggie}_${postfix}_rods" type="fixed">
        <origin rpy="0 0.087266 ${reflect*-0.453786}" xyz="${reflect*0} 0 15E-03"/>
        <parent link="boggie_${boggie}_${postfix}_rods"/>
        <child link="differential_rod_${postfix}_${boggie}"/>
    </joint> -->
</xacro:macro>
<xacro:differential_rod postfix="front" boggie="right" reflect="1"/>
<!-- end differential_rod -->